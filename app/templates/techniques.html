<!-- app/templates/techniques.html -->
{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-list"></i> ATT&CK Techniques</h1>
    <div>
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<!-- Filter Section -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h5>Filter by Tactic</h5>
                <div class="btn-group flex-wrap">
                    <a href="{{ url_for('main.techniques') }}" class="btn btn-outline-primary">All</a>
                    {% for tactic in techniques[0].tactics if techniques %}
                        <a href="{{ url_for('main.techniques', tactic=tactic) }}" 
                           class="btn btn-outline-primary">{{ tactic }}</a>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-6">
                <h5>Search Techniques</h5>
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search by name, ID, or description...">
                    <button class="btn btn-primary" onclick="searchTechniques()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Techniques List -->
<div class="row" id="techniquesList">
    {% for technique in techniques %}
    <div class="col-md-6 mb-3 technique-item">
        <div class="card technique-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong class="text-primary">{{ technique.technique_id }}</strong>
                {% if technique.is_subtechnique %}
                <span class="badge bg-warning">Sub-technique</span>
                {% endif %}
            </div>
            <div class="card-body">
                <h5 class="card-title">
                    <a href="{{ url_for('main.technique_detail', technique_id=technique.technique_id) }}" 
                       class="text-decoration-none">
                        {{ technique.name }}
                    </a>
                </h5>
                <p class="card-text">{{ technique.description[:200] }}{% if technique.description|length > 200 %}...{% endif %}</p>
                
                <div class="mb-2">
                    {% for tactic in technique.tactics %}
                    <span class="badge bg-secondary me-1">{{ tactic }}</span>
                    {% endfor %}
                </div>
                
                <div class="mb-2">
                    <small class="text-muted">
                        <strong>Platforms:</strong> {{ technique.platforms|join(', ') }}
                    </small>
                </div>
            </div>
            <div class="card-footer">
                <a href="{{ url_for('main.technique_detail', technique_id=technique.technique_id) }}" 
                   class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-info-circle"></i> Details
                </a>
                <a href="{{ technique.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-external-link-alt"></i> MITRE
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- No Results Message (hidden by default) -->
<div id="noResults" class="text-center mt-4" style="display: none;">
    <div class="alert alert-warning">
        <h4><i class="fas fa-search"></i> No techniques found</h4>
        <p>Try adjusting your search terms or filters.</p>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function searchTechniques() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const techniqueItems = document.getElementsByClassName('technique-item');
    let visibleCount = 0;
    
    for (let item of techniqueItems) {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            item.style.display = 'block';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    }
    
    // Show/hide no results message
    const noResults = document.getElementById('noResults');
    if (visibleCount === 0) {
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
    }
}

// Enable search on Enter key
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchTechniques();
    }
});
</script>
{% endblock %}